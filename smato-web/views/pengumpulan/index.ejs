<%- include('../partials/_head.ejs') %>
<%- include('../partials/_nav.ejs') %>

<div class="container mt-5">
  <h2 class="mb-4">Riwayat Pengumpulan Tugas</h2>

  <% if (messageError && messageError.length > 0) { %>
    <div class="alert alert-danger"><%= messageError[0] %></div>
  <% } %>

  <% if (success && success.length > 0) { %>
    <div class="alert alert-success"><%= success[0] %></div>
  <% } %>

  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>No</th>
      
        <th>Nama Siswa</th>
        <th>Nama Mapel</th>
        <th>Upload Time</th>
        <th>Nama Tugas</th>
        <th>Nama Guru</th>
        <th>File Tugas</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
      <% if (dataPengumpulan && dataPengumpulan.length === 0) { %>
        <tr>
          <td colspan="8" class="text-center">Belum ada pengumpulan tugas</td>
        </tr>
      <% } else { %>
        <% dataPengumpulan.forEach((item, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><%= item.nama_siswa %></td>
            <td><%= item.nama_mapel %></td>
            <td><%= item.upload_time || '-' %></td>
            <td><%= item.nama_tugas %></td>
            <td><%= item.nama_guru || '-' %></td>
            <td>
              <% if (item.file_tugas) { %>
                <a href="/pengumpulan/download/<%= item.file_tugas %>" class="btn btn-sm btn-primary">Unduh</a>
              <% } else { %>
                <span class="text-muted">Belum Upload</span>
              <% } %>
            </td>
            <td>
              <% if (level === 'guru') { %>
                <% if (!item.file_tugas) { %>
                  <a href="/pengumpulan/edit/<%= item.id_tugas %>" class="btn btn-sm btn-success">Upload</a>
                <% } else { %>
                 
                <% } %>
              <% } %>
    
              <% if (level === 'guru') { %>
                <a href="/pengumpulan/delete/<%= item.id_pengumpulan %>" class="btn btn-sm btn-danger" onclick="return confirm('Yakin ingin menghapus tugas ini?')">Delete</a>
              <% } %>
            </td>
          </tr>
        <% }) %>
      <% } %>
    </tbody>
    
  </table>
</div>

<%- include('../partials/_foot.ejs') %>
