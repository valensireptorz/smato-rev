<%- include('../partials/_head.ejs') %>

<%- include('../partials/_nav.ejs') %>
<!-- Content wrapper -->
<div class="content-wrapper">
  <!-- Content -->
  <div class="container-xxl flex-grow-1 container-p-y">
    <div class="row">
      <div class="col-12">
        <div class="card shadow-lg border-0">
          <div class="card-header bg-primary text-white p-4">
            <div class="d-flex justify-content-between align-items-center">
              <h4 class="mb-0 text-white">Registrasi Siswa Baru</h4>
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb breadcrumb-light mb-0">
                  <li class="breadcrumb-item"><a href="#" class="text-white">Forms</a></li>
                  <li class="breadcrumb-item active text-white" aria-current="page">Add Siswa</li>
                </ol>
              </nav>
            </div>
          </div>
          
          <div class="card-body p-5">
            <div class="row mb-4">
              <div class="col-md-8">
                <h5 class="fw-bold text-primary">Informasi Akun Siswa</h5>
                <p class="text-muted">Lengkapi informasi siswa untuk membuat akun baru</p>
              </div>
              <div class="col-md-4 text-md-end">
                <div class="badge bg-label-primary p-2">
                  <i class="bx bx-user-plus me-1"></i> 
                  <span>Pendaftaran Baru</span>
                </div>
              </div>
            </div>
            
            <% if (error.length > 0) { %>
              <div class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
                <div class="d-flex gap-2">
                  <i class="bx bx-error-circle fs-4"></i>
                  <div>
                    <strong>Error!</strong> <%= error[0] %>
                  </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            <% } %>
            
            <% if (success.length > 0) { %>
              <div class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
                <div class="d-flex gap-2">
                  <i class="bx bx-check-circle fs-4"></i>
                  <div>
                    <strong>Sukses!</strong> <%= success[0] %>
                  </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            <% } %>
            
            <div class="row">
              <div class="col-lg-12">
                <form action="/siswa/store" method="POST" class="row g-4">
                  <div class="col-md-6">
                    <div class="card border shadow-sm h-100">
                      <div class="card-header bg-light py-3">
                        <h6 class="mb-0"><i class="bx bx-user me-2 text-primary"></i>Data Pribadi</h6>
                      </div>
                      <div class="card-body">
                        <div class="mb-4">
                          <label for="nama_siswa" class="form-label fw-semibold">Nama Lengkap Siswa</label>
                          <div class="input-group input-group-merge">
                            <span class="input-group-text"><i class="bx bx-user"></i></span>
                            <input type="text" class="form-control" name="nama_siswa" id="nama_siswa" placeholder="Masukkan nama lengkap" required />
                          </div>
                          <small class="text-muted">Gunakan nama lengkap sesuai dokumen resmi</small>
                        </div>
                        
                        <div class="mb-4">
                          <label for="nis" class="form-label fw-semibold">NIS (Nomor Induk Siswa)</label>
                          <div class="input-group input-group-merge">
                            <span class="input-group-text"><i class="bx bx-id-card"></i></span>
                            <input type="text" class="form-control" name="nis" id="nis" placeholder="Masukkan NIS" required />
                          </div>
                          <small class="text-muted">Format: XXXXXXXX (4 digit angka)</small>
                        </div>
                        
                        <div class="mb-0">
                          <label for="alamat" class="form-label fw-semibold">Alamat</label>
                          <div class="input-group input-group-merge">
                            <span class="input-group-text"><i class="bx bx-home"></i></span>
                            <textarea class="form-control" name="alamat" id="alamat" rows="3" placeholder="Masukkan alamat lengkap" required></textarea>
                          </div>
                          <small class="text-muted">Tulis alamat lengkap termasuk RT/RW dan kode pos</small>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-md-6">
                    <div class="card border shadow-sm h-100">
                      <div class="card-header bg-light py-3">
                        <h6 class="mb-0"><i class="bx bx-building-house me-2 text-primary"></i>Data Akademik</h6>
                      </div>
                      <div class="card-body">
                        <div class="mb-4">
                          <label for="id_kelas" class="form-label fw-semibold">Kelas</label>
                          <div class="input-group input-group-merge">
                            <span class="input-group-text"><i class="bx bx-building"></i></span>
                            <select class="form-select" name="id_kelas" id="id_kelas" required>
                              <option selected disabled value="">Pilih Kelas</option>
                              <% for (var i = 0; i < data_kelas.length; i++) { %>
                                <option value="<%= data_kelas[i].id_kelas %>">
                                  <%= data_kelas[i].kode_kelas %>
                                </option>
                              <% } %>
                            </select>
                          </div>
                          <small class="text-muted">Pilih kelas yang sesuai dengan jenjang siswa</small>
                        </div>
                        
                        <div class="mb-4">
                          <label for="password" class="form-label fw-semibold">Password</label>
                          <div class="input-group input-group-merge">
                            <span class="input-group-text"><i class="bx bx-lock-alt"></i></span>
                            <input type="text" class="form-control" name="password" id="password" placeholder="Generated password" readonly />
                            <button class="btn btn-outline-primary" type="button" id="generateNewPassword">
                              <i class="bx bx-refresh"></i>
                            </button>
                          </div>
                          <small class="text-muted">Password akan digenerate secara otomatis</small>
                        </div>
                        
                        <div class="mt-4 pt-2">
                          <div class="alert alert-info p-3 mb-0">
                            <div class="d-flex">
                              <i class="bx bx-info-circle fs-4 me-2"></i>
                              <div>
                                <strong>Info Penting:</strong>
                                <p class="mb-0">Password ini akan digunakan siswa untuk login pertama kali. Simpan dan informasikan kepada siswa dengan aman.</p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="col-12">
                    <div class="card border shadow-sm">
                      <div class="card-body">
                        <div class="row align-items-center">
                          <div class="col-md-6">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="confirmData" required>
                              <label class="form-check-label" for="confirmData">
                                Saya menyatakan data yang diinput sudah benar
                              </label>
                            </div>
                          </div>
                          <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <a href="/siswa" class="btn btn-outline-secondary me-2">
                              <i class="bx bx-arrow-back me-1"></i> Kembali
                            </a>
                            <button type="submit" class="btn btn-primary">
                              <i class="bx bx-save me-1"></i> Simpan Data
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Fungsi untuk generate password acak
  function generatePassword(length = 10) {
    const lowercase = "abcdefghijklmnopqrstuvwxyz";
    const uppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const numbers = "0123456789";
    const special = "!@#$%^&*";
    
    const allChars = lowercase + uppercase + numbers + special;
    let password = "";
    
    // Memastikan password memiliki minimal 1 karakter dari setiap kategori
    password += lowercase.charAt(Math.floor(Math.random() * lowercase.length));
    password += uppercase.charAt(Math.floor(Math.random() * uppercase.length));
    password += numbers.charAt(Math.floor(Math.random() * numbers.length));
    password += special.charAt(Math.floor(Math.random() * special.length));
    
    // Tambahkan karakter acak untuk mencapai panjang yang diinginkan
    for (let i = 4; i < length; i++) {
      password += allChars.charAt(Math.floor(Math.random() * allChars.length));
    }
    
    // Acak urutan karakter
    return password.split('').sort(() => 0.5 - Math.random()).join('');
  }

  // Saat halaman dimuat, isi otomatis field password
  window.addEventListener("DOMContentLoaded", () => {
    const passwordField = document.getElementById("password");
    if (passwordField && !passwordField.value) {
      passwordField.value = generatePassword();
    }
    
    // Tambahkan event listener untuk tombol generate password baru
    const generateBtn = document.getElementById("generateNewPassword");
    if (generateBtn) {
      generateBtn.addEventListener("click", () => {
        passwordField.value = generatePassword();
      });
    }
    
    // Validasi form sebelum submit
    const form = document.querySelector("form");
    form.addEventListener("submit", (event) => {
      const nisInput = document.getElementById("nis");
      
      // Validasi NIS (hanya angka)
      if (!/^\d+$/.test(nisInput.value)) {
        event.preventDefault();
        alert("NIS hanya boleh berisi angka!");
        nisInput.focus();
      }
    });
    
    // Tambahkan animasi highlight pada field yang aktif
    const formInputs = document.querySelectorAll('.form-control, .form-select');
    formInputs.forEach(input => {
      input.addEventListener('focus', () => {
        input.closest('.input-group').classList.add('border-primary');
      });
      
      input.addEventListener('blur', () => {
        input.closest('.input-group').classList.remove('border-primary');
      });
    });
  });
</script>

<%- include('../partials/_foot.ejs') %>