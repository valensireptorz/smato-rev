<%- include('../partials/_head.ejs') %>
<%- include('../partials/_nav.ejs') %>

<div class="container mt-5">
  <h3>Tambah Absen</h3>
  <form action="/absen/store" method="POST">
    
    <div class="mb-3">
      <label class="form-label">Mata Pelajaran</label>
      <input type="text" class="form-control" value="<%= nama_mapel %>" readonly>
      <input type="hidden" name="id_mapel" value="<%= id_mapel %>">
    </div>
    
    <div class="mb-3">
      <label for="id_guru" class="form-label">Guru</label>
      <input type="text" class="form-control" value="<%= nama_guru_login %>" readonly>
      <input type="id" name="id_guru" value="<%= id_guru_login %>">
    </div>

    <div class="mb-3">
      <label for="id_kelas" class="form-label">Kelas</label>
      <select class="form-control" name="id_kelas" required>
        <option value="">-- Pilih Kelas --</option>
        <% dataKelas.forEach((kelas) => { %>
          <option value="<%= kelas.id_kelas %>"><%= kelas.nama_kelas %> - <%= kelas.kode_kelas %></option>
        <% }); %>
      </select>
    </div>
    
    <div class="mb-3">
      <label for="jam_selesai" class="form-label">Jam Selesai</label>
      <input type="time" class="form-control" name="jam_selesai" required>
    </div>
    
    <div class="mb-3">
      <label for="tanggal" class="form-label"></label>
      <input type="date" class="form-control" name="tanggal" id="tanggal" required hidden>
    </div>

    <div class="mb-3">
      <label for="jam_mulai" class="form-label"></label>
      <input type="time" class="form-control" name="jam_mulai" id="jam_mulai" required hidden>
    </div>

    <button type="submit" class="btn btn-primary">Simpan</button>
  </form>
</div>

<script>
  // Set nilai tanggal dan jam_mulai sesuai zona waktu Asia/Jakarta (WIB)
  document.addEventListener("DOMContentLoaded", function () {
    // Gunakan Intl.DateTimeFormat untuk zona waktu Asia/Jakarta
    const formatter = new Intl.DateTimeFormat("id-ID", {
      timeZone: "Asia/Jakarta",
      year: "numeric",
      month: "2-digit",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      hour12: false,
    });

    // Dapatkan bagian-bagian waktu
    const parts = formatter.formatToParts(new Date());
    const partMap = Object.fromEntries(parts.map(p => [p.type, p.value]));

    const formattedDate = `${partMap.year}-${partMap.month}-${partMap.day}`;
    const formattedTime = `${partMap.hour}:${partMap.minute}`;

    // Set ke input
    document.getElementById("tanggal").value = formattedDate;
    document.getElementById("jam_mulai").value = formattedTime;
  });
</script>

<%- include('../partials/_foot.ejs') %>
